<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>T√≠nh L√£i Su·∫•t Vay (C·ªßa Thi√™n)</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #f5faff;
    }

    .marquee {
      width: 100vw;
      position: relative;
      overflow: hidden;
      background: #007bff;
      color: #fff;
      padding: 12px 0;
      font-weight: bold;
      font-size: 16px;
      box-sizing: border-box;
      left: 50%;
      right: 50%;
      margin-left: -50vw;
      margin-right: -50vw;
    }

    .marquee-content {
      display: inline-block;
      white-space: nowrap;
      animation: marquee 15s linear infinite;
    }

    .marquee:hover .marquee-content {
      animation-play-state: paused;
    }

    @keyframes marquee {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: linear-gradient(135deg, #d0e6f7, #f5faff);
      box-sizing: border-box;
    }

    h1 {
      text-align: center;
      border: 2px solid #007bff;
      display: inline-block;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 28px;
    }

    label { display: block; margin-top: 10px; }
    input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      font-size: 16px;
      box-sizing: border-box;
    }

    button {
      margin-top: 15px;
      padding: 12px 20px;
      margin-right: 10px;
      font-size: 16px;
      cursor: pointer;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }

    table, th, td { border: 1px solid #333; }
    th, td {
      padding: 8px;
      text-align: center;
      font-size: 15px;
    }

    .note { margin-top: 10px; font-style: italic; color: #333; }
    footer { text-align: center; margin-top: 40px; font-size: 14px; color: #555; }

    /* Responsive */
    @media (max-width: 600px) {
      h1 {
        font-size: 22px;
        padding: 8px 16px;
      }
      .marquee {
        font-size: 14px;
        padding: 10px 0;
      }
      input, button {
        font-size: 15px;
      }
      button {
        width: 100%;
        margin-right: 0;
        margin-bottom: 10px;
      }
      table, th, td {
        font-size: 13px;
      }
      a[href*="zalo"] img {
        width: 50px;
        height: 50px;
      }
    }
  </style>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-1LMJZ7XXG0"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-1LMJZ7XXG0');
  </script>
</head>
<body>

  <!-- Ch·ªØ ch·∫°y fix l·ªói full m√†n h√¨nh -->
  <div class="marquee">
    <div class="marquee-content">
      üí∏ Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi c√¥ng c·ª• T√≠nh L√£i Su·∫•t Vay c·ªßa Mr Thi√™n! üìû Li√™n h·ªá Zalo: 0964307247 ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ nhanh ch√≥ng v√† uy t√≠n! üöÄ
    </div>
  </div>

  <div class="container">
    <h1>T√≠nh L√£i Su·∫•t Vay</h1>

    <label>Ng√†y Gi·∫£i Ng√¢n:
      <input type="date" id="disbursalDate" />
    </label>

    <label>Ng√†y K·ª≥ ƒê√≥ng ƒê·∫ßu Ti√™n:
      <input type="date" id="firstEmiDate" />
    </label>

    <label>S·ªë Ti·ªÅn Vay (VND):
      <input type="text" id="loanAmount" value="" oninput="formatNumber(this)" />
    </label>

    <label>% B·∫£o Hi·ªÉm Kho·∫£n Vay (n·∫øu c√≥):
      <input type="number" id="insurancePercent" value="7.7" step="0.1" />
    </label>

    <label>L√£i Su·∫•t (%/nƒÉm):
      <input type="number" id="interestRate" value="52" />
    </label>

    <label>S·ªë K·ª≥ Vay (th√°ng):
      <input type="number" id="months" value="24" />
    </label>

    <button onclick="calculateLoan()">T√≠nh L·ªãch Thanh To√°n Tham Kh·∫£o</button>
    <button onclick="printPDF()">In PDF</button>
    <button onclick="exportExcel()">Xu·∫•t Excel</button>

    <div id="result"></div>

    <footer>¬© Copyright 2025 V√µ Qu·ªëc Thi√™n. Gi·∫£i Ph√°p Vay Ti√™u D√πng Uy T√≠n & Linh Ho·∫°t</footer>
  </div>

  <!-- Th∆∞ vi·ªán SheetJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    function formatNumber(input) {
      let value = input.value.replace(/\D/g, "");
      if (value) {
        input.value = Number(value).toLocaleString('vi-VN').replace(/,/g, '.');
      } else {
        input.value = "";
      }
    }

    function parseNumber(str) {
      return Number(str.replace(/\./g, ""));
    }

    function calculateLoan() {
      const disbursalDate = new Date(document.getElementById('disbursalDate').value);
      const firstEmiDate = new Date(document.getElementById('firstEmiDate').value);
      const loanAmount = parseNumber(document.getElementById('loanAmount').value);
      const insurancePercent = Number(document.getElementById('insurancePercent').value);
      const interestRate = Number(document.getElementById('interestRate').value);
      const months = Number(document.getElementById('months').value);

      const insurance = loanAmount * insurancePercent / 100;
      const totalLoan = loanAmount + insurance;
      const monthlyRate = interestRate / 12 / 100;

      const EMI = totalLoan * monthlyRate * Math.pow(1 + monthlyRate, months) / (Math.pow(1 + monthlyRate, months) - 1);
      const collectionFee = 12000;

      let table = `<h2>K·∫øt Qu·∫£</h2>
                  <p>T·ªïng vay + BH: ${totalLoan.toLocaleString().replace(/,/g, '.')} VND</p>
                  <p>Ph√≠ thu h·ªô m·ªói k·ª≥: ${collectionFee.toLocaleString().replace(/,/g, '.')} VND (c·ªë ƒë·ªãnh)</p>
                  <p>T·ªïng thanh to√°n h√†ng th√°ng (g·ªìm ph√≠ thu h·ªô): ${(EMI + collectionFee).toLocaleString(undefined, {maximumFractionDigits: 0}).replace(/,/g, '.')} VND</p>
                  <table id="repaymentTable">
                  <tr><th>K·ª≥</th><th>Ng√†y Thanh To√°n</th><th>Ti·ªÅn G·ªëc</th><th>Ti·ªÅn L√£i</th><th>T·ªïng Ti·ªÅn ƒê√≥ng</th><th>D∆∞ N·ª£ C√≤n L·∫°i</th></tr>`;

      let remaining = totalLoan;

      for (let i = 1; i <= months; i++) {
        let interest = remaining * monthlyRate;
        let principal = EMI - interest;

        let payDate = new Date(firstEmiDate);
        payDate.setMonth(payDate.getMonth() + i - 1);

        table += `<tr>
          <td>${i}</td>
          <td>${payDate.toLocaleDateString()}</td>
          <td>${principal.toLocaleString(undefined, {maximumFractionDigits: 0}).replace(/,/g, '.')}</td>
          <td>${interest.toLocaleString(undefined, {maximumFractionDigits: 0}).replace(/,/g, '.')}</td>
          <td>${(EMI + collectionFee).toLocaleString(undefined, {maximumFractionDigits: 0}).replace(/,/g, '.')}</td>
          <td>${(remaining - principal).toLocaleString(undefined, {maximumFractionDigits: 0}).replace(/,/g, '.')}</td>
        </tr>`;

        remaining -= principal;
      }

      table += `</table>`;
      table += `<p class="note">ƒê√¢y ch·ªâ l√† b·∫£ng tham kh·∫£o, vui l√≤ng li√™n h·ªá tr·ª±c ti·∫øp nh√¢n vi√™n ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n c·ª• th·ªÉ v√† ch√≠nh x√°c.</p>`;
      document.getElementById('result').innerHTML = table;
    }

    function printPDF() {
      window.print();
    }

    function exportExcel() {
      let table = document.getElementById('repaymentTable');
      if (!table) {
        alert("Vui l√≤ng t√≠nh l·ªãch thanh to√°n tr∆∞·ªõc khi xu·∫•t Excel.");
        return;
      }
      let wb = XLSX.utils.table_to_book(table, { sheet: "LichThanhToan" });
      XLSX.writeFile(wb, "Lich_Thanh_Toan.xlsx");
    }
  </script>

  <!-- Icon Zalo -->
  <a href="https://zalo.me/0964307247" target="_blank" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 999;
  ">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/Icon_of_Zalo.svg/1024px-Icon_of_Zalo.svg.png" alt="Zalo" style="width:60px; height:60px;">
  </a>

</body>
</html>
